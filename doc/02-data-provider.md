第1章 データ プロバイダー
=====

[↑目次](..\README.md "目次")

[←第1章 2つの世界](01-two-worlds.md)

.NET FrameworkからDBアクセスするためのデータベース・ドライバーが「データ プロバイダー」です。その構成や処理イメージを学んでいきましょう。

## DBアクセスのイメージ

データプロバイダーの構成を学ぶ前に、今一度「DBアクセスする」というのはどういう手順で行うのか考えてみましょう。アプリケーションのプラットフォームやプログラミング言語によって多少の違いはあるかもしれませんが、おおまかに次のような流れになるはずです。

2. データベース接続を開く
3. トランザクションを開始する
4. SQLを実行する
5. SQL実行結果を受け取る
6. トランザクションをコミット/ロールバックする
7. データベース接続を閉じる

## 1. データベース接続を開く

第1章で述べたとおり、アプリケーションからDBにアクセスするには、データベース・ドライバーを経由する必要があります。この時、データベース・ドライバーとDBの間には「データベース接続」と呼ばれる、専用のアクセス通路のようなものが構築されます。そして、アプリケーション側ではデータベース・ドライバーが作成したデータベース接続を「借りて」DBにアクセスします（図2-1）。

![データベース接続を開く](../image/02-01.jpg)

図2-1 データベース接続を開く

このようデータベース・ドライバーにデータベース接続を作成してDBアクセス可能な状態にすることを、「データベース接続を開く」といいます。

## 2. トランザクションを開始する

意味のある処理の塊をまとめる「トランザクション」が必要なら、やはりデータベース・ドライバーに依頼してトランザクションを開始します（図2-2）。

![トランザクション開始](../image/02-02.jpg)

図2-2 トランザクション開始

## 3. SQLを実行する

SQL文を発行する準備が整ったところで、SQLを実行します。この時実行するSQLは、データベースオブジェクト等を操作するDML、テーブルデータの登録、参照、更新、削除（CRUD：Create, Read, Update, Delete）を行うDMLに加えて、ストアドプロシージャの呼び出し等もあります（図2-3）。

![SQLの実行](../image/02-03.jpg)

図2-3 SQLの実行

## 4. SQL実行結果を受け取る

SQLを実行したら、その結果を受け取ります。DMLの場合、SELCT文ならDBの機能である「カーソル」を制御するためのオブジェクト、INSERT、UPDATE、DELETE文なら処理が行われたレコード件数が受け取れます。

この他、データベース側で発生したエラー情報も、例外等を使って受け取ることが出来ます（図2-4）。

![SQL実行結果受け取り](../image/02-04.jpg)

図2-4 SQL実行結果受け取り


[→第3章 DBに接続する](02-data-provider.md)
